kind: playground
name: my-my-k3s-de88e13a
base: k3s
title: OWASP K8s (faster!)
description: K3s cluster with some vulnerabilities
categories:
    - kubernetes
playground:
    networks:
        - name: local
          subnet: 172.16.0.0/24
    machines:
        - name: cplane-01
          users:
            - name: root
            - name: laborant
              default: true
              welcome: |
                This lab has a deliberately misconfigured k3s cluster based on the OWASP top 10 Kubernetes vulnerabilities. The namespace for all vulnerable resources is "test-lab". When you find and fix the vulnerability (probably by editing the deployment), the cluster will automatically reset to another vulnerability.

                Find the vulnerabilities by running the following scans:

                # scan the entire namespace with kubescape (this one will give you the general issue)
                $ kubescape scan --include-namespaces test-lab

                # scan a specific kubescape control within the namespace (this one will tell you which resource has the issue)
                $ kubescape scan control C-0057 -v --include-namespaces test-lab

                You can get notifications when the cluster is resetting and also when it's ready for another scan.

                Click on the button that says notifications, then if you click the "popout" icon, it'll open in a new browser tab and you can enable notifications that will automatically pop up during the cluster vulnerability lifecycle.
          drives:
            - source: oci://ghcr.io/lpmi-13/owasp-k3s-cluster-iximiuz:v4
              mount: /
              size: 30GiB
          network:
            interfaces:
                - address: 172.16.0.2/24
                  network: local
          resources:
            cpuCount: 4
            ramSize: 8GiB
    tabs:
        - id: terminal-cplane-01
          kind: terminal
          name: cplane-01
          machine: cplane-01
        - id: http-port-ltvrhte8a6d
          kind: http-port
          name: notifications
          machine: cplane-01
          number: 8888
          access: public
    initTasks:
        init_cplane_01_1:
            name: init_cplane_01_1
            machine: cplane-01
            init: true
            user: root
            timeout_seconds: 60
            run: |-
                #!/bin/bash

                kubectl wait --for=condition=Ready --timeout=60s pods --all -n test-lab
    accessControl:
        canList:
            - owner
        canRead:
            - owner
        canStart:
            - owner
